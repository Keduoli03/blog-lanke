---
import { getCollection } from 'astro:content'
import { Icon } from 'astro-icon/components'
import { items as tsItems } from '@/content/friends/friends'

type Friend = {
  title: string
  description: string
  avatar: string
  link: string
}

const fromCollection = (await getCollection('friends')).map((f) => ({
  title: f.data.title,
  description: f.data.description,
  avatar: f.data.avatar,
  link: f.data.link,
})) as Friend[]

const fromTs = (tsItems || []).map((x: any) => ({
  title: x.title,
  description: x.desc ?? x.description ?? '',
  avatar: x.imgurl ?? x.avatar ?? '',
  link: x.siteurl ?? x.link ?? '',
})) as Friend[]

const friends = [...fromTs, ...fromCollection].filter((f) => f.title && f.link)
---

<ul class="grid grid-cols-1 sm:grid-cols-2 gap-4 md:gap-8">
  {
    friends.map((friend) => (
      <li>
        <a href={friend.link} target="_blank" rel="noopener noreferrer external">
          <div class="p-4 flex gap-2 bg-accent/10 rounded-lg group">
            <img
              class="shrink-0 size-16 object-contain rounded-full"
              src={friend.avatar}
              alt={`Friend avatar: ${friend.title}`}
              loading="lazy"
            />
            <div class="min-w-0 grow">
              <div class="truncate font-bold text-xl group-hover:text-accent">{friend.title}</div>
              <div class="text-sm line-clamp-2">{friend.description}</div>
            </div>
            <Icon class="shrink-0 group-hover:text-accent" name="ri:external-link-line" />
          </div>
        </a>
      </li>
    ))
  }
</ul>
