@import 'tailwindcss';
@plugin "@tailwindcss/typography";
@import 'rehype-callouts/theme/github';

/*
  ==========================================================================
  Markdown 全局样式定制 (最终清理版)
  ==========================================================================
*/

/*
  移动端基础字体大小调整
  ==========================================================================
*/

@media (max-width: 768px) {
  .prose {
    @apply text-sm; /* 移动端调小 */
  }

  /* 移动端段落缩进调整 */
  .prose p {
    text-indent: 1.5em;
  }

  /* 移动端标题大小调整 */
  .prose h1 {
    @apply text-2xl;
  }
  .prose h2 {
    @apply text-xl;
  }
  .prose h3 {
    @apply text-lg;
  }
  .prose h4 {
    @apply text-base;
  }
  .prose h5 {
    @apply text-sm;
  }
  .prose h6 {
    @apply text-xs;
  }
}

.prose {
  overflow-wrap: anywhere;
  word-break: break-word;
}

.prose img {
  max-width: 100%;
  height: auto;
  width: auto; /* 允许 width 属性生效 */
  margin: 0 auto; /* 全局图片居中 */
  display: block; /* 确保 margin auto 生效 */
}

.prose pre {
  max-width: 100%;
  overflow-x: auto;
}
/* 
  干掉一些样式
  =============================================================================
*/
/* 移除 code 标签的装饰性反引号 */
code::before,
code::after {
  content: none !important;
}
.prose code::before,
.prose code::after {
  content: '' !important;
}

/* 
  行内代码块
  ==========================================================================
*/
.prose :not(pre) > code {
  @apply rounded px-1.5 py-1 font-mono;
  background-color: hsl(var(--primary-hue), 60%, 95%);
  color: hsl(var(--primary-hue), 70%, 40%);
  font-size: 0.9em; /* 微调字体大小以匹配周围文本 */
}

.dark .prose :not(pre) > code {
  background-color: hsl(var(--primary-hue), 40%, 15%);
  color: hsl(var(--primary-hue), 60%, 70%);
}

/* 
  Mark 标签 (高亮)
  ==========================================================================
  移除默认的黄色背景，改为主题色文字，并允许内联样式覆盖
*/
.prose mark {
  background-color: transparent;
  color: var(--theme-color);
  font-weight: 500;
}

/*
  全局链接样式美化
  ==========================================================================
*/
.prose a {
  @apply underline decoration-dashed decoration-1 decoration-black/30 transition-all duration-200 dark:decoration-white/30;
  text-underline-offset: 3px;
}

.prose a:hover {
  @apply decoration-solid decoration-1 decoration-black/70 dark:decoration-white/70;
}
.dark .prose a {
  text-decoration-color: rgba(255, 255, 255, 0.3); /* 暗色模式: 更淡的半透明白 */
}

.dark .prose a:hover {
  text-decoration-color: rgba(255, 255, 255, 0.7); /* 暗色模式悬停: 稍微透明的白 */
}

/*
  深色模式正文和粗体文本颜色
  ==========================================================================
*/
.dark .prose {
  color: white;
}

.dark .prose strong {
  color: white;
}

/*
  1. 标题内锚点链接样式重置
  ==========================================================================
*/
.prose h1 a,
.prose h2 a,
.prose h3 a,
.prose h4 a,
.prose h5 a,
.prose h6 a {
  color: inherit;
  text-decoration: none;
}

/*
  2. 标题样式：左侧竖条 + 悬浮提示
  ==========================================================================
*/
.prose h1,
.prose h2,
.prose h3,
.prose h4,
.prose h5,
.prose h6 {
  @apply relative;
  overflow-wrap: normal;
  word-break: normal;
  white-space: normal;
  padding-left: 1rem;
}

/* 左侧竖条 (Theme Color Bar) */
.prose h1::before,
.prose h2::before,
.prose h3::before,
.prose h4::before,
.prose h5::before,
.prose h6::before {
  content: '';
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  width: 4px;
  height: 1.2em;
  background-color: var(--theme-color);
  border-radius: 2px;
}

/* 标题悬浮提示 (moved to ::after) */
.prose h1::after,
.prose h2::after,
.prose h3::after,
.prose h4::after,
.prose h5::after,
.prose h6::after {
  @apply absolute right-full top-1/2 -translate-y-1/2 mr-2 text-sm font-normal text-gray-400 opacity-0 transition-opacity duration-200 dark:text-gray-500;
}

.prose h1:hover::after,
.prose h2:hover::after,
.prose h3:hover::after,
.prose h4:hover::after,
.prose h5:hover::after,
.prose h6:hover::after {
  @apply opacity-100;
}

.prose h1::after {
  content: 'H1';
}
.prose h2::after {
  content: 'H2';
}
.prose h3::after {
  content: 'H3';
}
.prose h4::after {
  content: 'H4';
}
.prose h5::after {
  content: 'H5';
}
.prose h6::after {
  content: 'H6';
}

/* 
  表格样式
  ==================================================================
*/
.prose table {
  @apply w-full border-collapse mx-auto;
}

.prose th {
  @apply font-semibold text-center;
  color: var(--text-primary) !important;
}

.prose td {
  @apply text-center;
  color: var(--text-primary) !important;
}

/* 深色模式下的表格样式 */
.dark .prose th {
  color: var(--text-primary) !important;
}

.dark .prose td {
  color: var(--text-primary) !important;
}

/* 表格边框样式 */
.prose th,
.prose td {
  @apply border border-gray-400 px-3 py-2;
}

.dark .prose th,
.dark .prose td {
  @apply border-gray-500;
}

/*
  引用块 (Blockquote) 样式
  ==========================================================================
*/
.prose blockquote {
  /* 调整 padding 为上下 0.5rem(py-2) 左右 1rem(px-4)，margin 为 my-4 */
  /* 整体缩进 1.5em */
  @apply relative px-4 py-2 my-4 rounded-md shadow-sm transition-all duration-300;
  margin-left: 1.5em;
  width: auto;

  /* 仿 Callout 结构 */
  border: none; /* 重置默认边框 */
  border-left: 4px solid hsl(var(--primary-hue), 60%, 50%);
  background-color: hsl(var(--primary-hue), 80%, 96%); /* 极浅的主题色背景 */

  /* 添加三边细边框 */
  border-top: 1px solid hsl(var(--primary-hue), 60%, 90%);
  border-right: 1px solid hsl(var(--primary-hue), 60%, 90%);
  border-bottom: 1px solid hsl(var(--primary-hue), 60%, 90%);

  color: var(--text-secondary);
}

.prose blockquote:hover {
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
  border-top-color: hsl(var(--primary-hue), 60%, 85%);
  border-right-color: hsl(var(--primary-hue), 60%, 85%);
  border-bottom-color: hsl(var(--primary-hue), 60%, 85%);
}

/* 移动端引用块调整 */
@media (max-width: 768px) {
  .prose blockquote {
    @apply px-3 py-2 my-3 text-sm;
  }
}

/* 深色模式下的引用块样式 */
html.dark .prose blockquote {
  background-color: hsl(var(--primary-hue), 30%, 15%); /* 深色背景，保持低饱和度 */
  border-left-color: hsl(var(--primary-hue), 50%, 60%);

  /* 深色模式边框 */
  border-top: 1px solid hsl(var(--primary-hue), 30%, 25%);
  border-right: 1px solid hsl(var(--primary-hue), 30%, 25%);
  border-bottom: 1px solid hsl(var(--primary-hue), 30%, 25%);

  color: var(--text-secondary);
}

html.dark .prose blockquote:hover {
  border-top-color: hsl(var(--primary-hue), 30%, 35%);
  border-right-color: hsl(var(--primary-hue), 30%, 35%);
  border-bottom-color: hsl(var(--primary-hue), 30%, 35%);
}

/* 移除装饰性引用符号 */
.prose blockquote::before {
  content: none;
}

html.dark .prose blockquote::before {
  content: none;
}

.prose blockquote p:first-of-type::before {
  content: none;
}

.prose blockquote p {
  @apply m-0 relative z-10;
  text-indent: 0;
}

/* 脚注样式调整 */
/* 隐藏自动生成的 Footnotes 标题 */
.prose .footnotes h2,
.prose #footnote-label {
  @apply hidden;
}

/* 脚注区域分割线及整体样式 */
.prose .footnotes {
  @apply mt-12 pt-8 border-t border-[var(--line-divider)] text-sm;
}

/* 脚注标题 "注：" */
.prose .footnotes::before {
  content: '注：';
  @apply block font-bold mb-4 text-base;
}

.prose .footnote-ref,
.prose sup > a[href^='#fn'],
.prose sup > a[href^='#user-content-fn'] {
  @apply no-underline opacity-80 hover:opacity-100 transition-opacity cursor-pointer;
  color: var(--theme-color);
}

.prose .footnote-ref::before,
.prose sup > a[href^='#fn']::before,
.prose sup > a[href^='#user-content-fn']::before {
  content: '[';
}

.prose .footnote-ref::after,
.prose sup > a[href^='#fn']::after,
.prose sup > a[href^='#user-content-fn']::after {
  content: ']';
}

/* 脚注悬浮提示框 */
.footnote-tooltip {
  @apply fixed z-50 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 p-3 rounded-lg shadow-xl text-sm max-w-xs pointer-events-none opacity-0 transition-opacity duration-200 text-gray-700 dark:text-gray-200;
  /* 确保提示框在最上层 */
  z-index: 9999;
}

.footnote-tooltip.show {
  @apply opacity-100;
}

/* 引用来源样式 */
.prose blockquote cite {
  @apply block mt-3 text-sm text-blue-600 italic
         dark:text-blue-400;
}

/* 移动端引用来源调整 */
@media (max-width: 768px) {
  .prose blockquote cite {
    @apply mt-2 text-xs;
  }
}

/*
  4. 段落与列表样式
  ==========================================================================
*/
.prose p {
  @apply [text-indent:2em];
}

.prose li > p {
  @apply [text-indent:0];
}

/* 移动端列表调整 */
@media (max-width: 768px) {
  .prose ul,
  .prose ol {
    @apply pl-4;
  }

  .prose li {
    @apply text-sm;
  }
  /* 修复 CJK 禁则导致的行尾空白：尽量填满每一行 */
  .prose p,
  .prose li,
  .prose blockquote p {
    line-break: anywhere;
    overflow-wrap: anywhere;
    word-break: break-all;
    white-space: normal;
  }
}

/*
  5. 媒体与代码块样式
  ==========================================================================
*/
.prose img {
  @apply rounded-lg shadow-md;
}

.prose pre {
  @apply bg-gray-800 text-gray-100 rounded-lg shadow-lg;
}

/* 移动端代码块调整 */
@media (max-width: 768px) {
  /* 行内代码调整 */
  .prose :not(pre) > code {
    @apply text-xs px-1 py-0.5;
  }

  /* 覆盖为更小字号与更紧凑内边距（手机端） */
  .prose pre {
    font-size: 0.5rem !important; /* ≈ 11px，更省空间 */
    line-height: 1.3;
    padding: 0.5rem 0.75rem;
  }
  .prose pre code {
    font-size: 0.85em; /* 让内部代码相对 pre 再小一点点 */
  }
}

/* 表格移动端调整 */
@media (max-width: 768px) {
  .prose table {
    @apply text-xs;
  }

  .prose th,
  .prose td {
    @apply px-2 py-1;
  }
}
