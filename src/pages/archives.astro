---
import Timeline from '@/components/Timeline.astro'
import Highlight from '@/components/Highlight.astro'
import PageLayout from '@/layouts/PageLayout.astro'
import { getOldestPosts } from '@/utils/content'
import { TimelineProgress } from '@/components/TimelineProgress'
import ArchiveFilter from '@/components/ArchiveFilter'
import { getAllTags, getAllCategories } from '@/utils/content'
import ColumnMenu from '@/components/columns/ColumnMenu.astro'

const oldestPosts = await getOldestPosts()
const categories = (await getAllCategories()).map((c) => c.name)
const tags = (await getAllTags()).map((t) => t.name)
const years = Array.from(new Set(oldestPosts.map((p) => (p.data.date as Date).getFullYear()))).sort(
  (a, b) => b - a,
)
---

<PageLayout title="归档">
  <div class="w-full px-4 md:px-8 py-16 grid gap-6 lg:grid-cols-[1fr_minmax(0,900px)_1fr]">
    <div class="lg:col-start-2">
      <header class="space-y-4 mb-8">
        <div class="flex items-center gap-4">
          <h1 class="text-4xl font-bold">
            <Highlight>归档</Highlight>
          </h1>
        </div>
        <p>共产出 {oldestPosts.length} 篇文章，再接再厉。</p>
        <hr class="w-[100px] border-primary" />
        <TimelineProgress client:load />
      </header>
      <Timeline posts={oldestPosts} />
    </div>
    <div
      class="hidden xl:block lg:col-start-3 justify-self-start w-[280px] -ml-4"
      data-pagefind-ignore
    >
      <aside class="sticky top-20">
        <ArchiveFilter client:only="react" categories={categories} tags={tags} years={years} />
      </aside>
    </div>
  </div>
</PageLayout>
